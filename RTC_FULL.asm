_DS		BIT		P1.7
SH_CP	BIT		P1.6
ST_CP	BIT		P1.5


_SEC	DATA	30H
_MIN	DATA	31H
_HOUR	DATA	32H
_DAY	DATA	33H
_DATE	DATA 	34H
_MONT	DATA	35H
_YEAR	DATA	36H
_CONT	DATA	37H
_TEMP	DATA	38H

C100MS	DATA	39H
C250MS	DATA	3AH
C500MS 	DATA	3BH
C1S		DATA	3CH
C10S	DATA	3DH


R8		DATA	40H
R9		DATA	41H
R10		DATA	42H
R11		DATA	42H


;BIEN HIEN TH
TEP1	DATA	50H
TEP2	DATA	51H
YEA1	DATA	52H
YEA2	DATA	53H
MON1	DATA	54H
MON2	DATA	55H
DAY1	DATA	56H
DAY2	DATA	57H
DAT1	DATA	58H
DAT2	DATA	59H
SEC1	DATA	5AH
SEC2	DATA	5BH
MIN1	DATA	5CH
MIN2	DATA	5DH
HOR1	DATA	5EH
HOR2	DATA	5FH




;DINH NGHIA BIT
FLAGS	DATA	22H
F1S		BIT		FLAGS.7
FR		BIT		FLAGS.6
FY		BIT		FLAGS.5
FG		BIT		FLAGS.4
TEM1  DATA 20H
T50MS  BIT  TEM1.0
T250MS BIT  TEM1.1
T500MS BIT  TEM1.2
T1S	   BIT  TEM1.3
T10S   BIT  TEM1.4
T100MS BIT	TEM1.5
ORG 	0000H
JMP		BEGIN
ORG		001BH
MOV TH1,#HIGH(-50000)
MOV TL1,#LOW (-50000)
CLR TF1
SETB T50MS
RETI


BEGIN:
MOV IE,#88H				;CHO PHEP NGAT DO BO DINH THOI 1
MOV TMOD,#10H			; TIMER 1 CHE DO 16BIT
SETB TF1
SETB TR1
MOV C100MS,#2
MOV C250MS,#5
MOV C500MS,#2
MOV C1S,#2
MOV C10S,#10	

MOV FLAGS,#11110000B
	
	
MOV 50H,#03Fh
MOV 51H,#06h
MOV 52H,#05Bh
MOV 53H,#04Fh
MOV 54H,#066h
MOV 55H,#06Dh
MOV 56H,#07Dh
MOV 57H,#07h
MOV 58H,#07Fh
MOV 59H,#06Fh

MOV 5AH,#03FH
MOV 5BH,#06h
MOV 5CH,#05Bh
MOV 5DH,#04Fh
MOV 5EH,#066h
MOV 5FH,#06Dh
CLR _DS
CLR SH_CP
CLR ST_CP

MAIN:
	CALL HIEN_THI
	CALL TIMING
	JMP MAIN


HIEN_THI:
		MOV R0,#50H
		MOV R8,#1
		MOV R9,#7
LOOP_HT:
		MOV A,FLAGS
		MOV R10,#8
LOOP_HTX:		
		MOV C,ACC.0
		MOV _DS,C
		SETB SH_CP
		CLR SH_CP
		RR A
		DJNZ R10,LOOP_HTX
		MOV R10,#16
LOOP_HT1:	
		MOV A,@R0
		MOV B,R8
		DIV AB
		MOV C,ACC.0
		MOV _DS,C
		SETB  SH_CP
		CLR   SH_CP
		INC R0
		DJNZ R10,LOOP_HT1
		MOV R0,#50H
		MOV R10,#8
		MOV A,R8
LOOP_HT2:
		MOV C,ACC.7
		MOV _DS,C
		SETB SH_CP
		CLR SH_CP
		RL A
		DJNZ R10,LOOP_HT2
		SETB ST_CP
		CLR  ST_CP
		MOV A,R8
		RL A
		MOV R8,A
		DJNZ R9,LOOP_HT
		RET
		
;CAC TIMER
TIMING:
		JNB T50MS,EX_TIMING
		CLR T50MS
		DJNZ C100MS,EX_100MS
		CPL T100MS
		CPL FR
		MOV C100MS,#2
EX_100MS:
		DJNZ C250MS,EX_TIMING
		CPL T250MS
		CPL FG
		MOV C250MS,#5
		DJNZ C500MS,EX_TIMING
		CPL T500MS
		CPL FY
		MOV C500MS,#2
		DJNZ C1S,EX_TIMING
		CPL T1S
		CPL F1S
		MOV C1S,#2
		DJNZ C10S,EX_TIMING
		CPL T10S
		MOV C10S,#10
EX_TIMING:
		RET		
		
maled:
db 03Fh
db 06h
db 05Bh
db 04Fh
db 066h
db 06Dh
db 07Dh
db 07h
db 07Fh 
db 06Fh

END
