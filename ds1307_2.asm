SCL BIT P3.0
SDA BIT P3.1
D_WR EQU 0D0H
D_RD EQU 0D1H
FLG  EQU 20H
_STOP BIT FLG.0
_ACK  BIT FLG.1
_STA  BIT FLG.2
_LAST BIT FLG.3
SEC DATA 25H
_DATA DATA 30H
_REP  DATA 31H
_POINT   DATA 32H
;DU LIEU CAN GUI
ADDESS	DATA 40H		;DIA CHI CAN TRUY CAP

_D1	DATA 41H		;DU LIEU NAP VAO
_D2	DATA 42H		;
_D3	DATA 43H		;
;...............

ORG	00
MAIN:
	SETB SCL		;SAN SANG
	SETB SDA		;<>
	MOV _REP,#1
	MOV _POINT,#40H
	MOV _DATA,#D_WR
	MOV ADDESS,#07H
	MOV _D1,#10H
	CALL SEND
	CALL DELAY100MS
	CALL DELAY100MS
	JMP $
	
	
	
;CHUONG TRINH CON NAY SE GUI DIA CHI(KHI DOC), DIA CHI + DU LIEU (KHI GHI)CHO RTC	
SEND:
	JNB SCL,FALL		;DAM BAO SDA,SCL MUC CAO
	JNB SDA,FALL
	CLR SDA
	CALL DELAY5US
	CLR SCL
	INC _REP
	INC _REP
	MOV R6,_REP		;SO LAN TRUYEN DU LIEU
REPEAT:
	MOV R7,#8
	MOV A,_DATA		;NAP DU LIEU
LOOP_SEND:
	RLC A
	MOV SDA,C
	SETB SCL
	CALL DELAY5US
	CLR SCL
	CALL DELAY5US
	DJNZ R7,LOOP_SEND
	SETB SCL
	CALL DELAY5US
	CLR SCL
	DJNZ R6,LOAD_DATA
	JMP END_SEND
LOAD_DATA:
	MOV R0,_POINT
	MOV _DATA,@R0
	INC _POINT
	CALL DELAY5US
	JMP REPEAT
END_SEND:
	CALL STOP
FALL:
	RET
STOP:
	CALL DELAY5US
	CLR SDA
	SETB SCL
	CALL DELAY5US
	SETB SDA
	RET
	


	

















DELAY5US:
	PUSH 0
	MOV R0,#5
	DJNZ R0,$
	POP 0
	RET
	
DELAY100MS:
	PUSH 0
	PUSH 1
	PUSH 2
	MOV R0,#10
LOOP0:
	MOV R1,#100
LOOP1:
	MOV R2,#100
	DJNZ R2,$
	DJNZ R1,LOOP1
	DJNZ R0,LOOP0
	POP 2
	POP 1
	POP 0
	RET
END