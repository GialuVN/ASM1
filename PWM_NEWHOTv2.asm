ORG 0


MT1	EQU 30H
MT2 EQU 31H
MT3	EQU 32H
MT4 EQU 33H
MT5	EQU 34H
MT6 EQU 35H
MT7	EQU 36H
MT8 EQU 37H

BEGIN:
MOV MT1,#254
MOV MT2,#200
MOV MT3,#150
MOV MT4,#100
MOV MT5,#60
MOV MT6,#30
MOV MT7,#15
MOV MT8,#5

MOV P3,#255




MAIN:
	MOV DPTR,#K1
	CALL LOAD
	MOV R5,#100
S1:
	CALL LOAD_PWM
	CALL SHIFT_R
	DJNZ R5,S1
	
	MOV DPTR,#K2
	CALL LOAD
	MOV R5,#100
S2:
	CALL LOAD_PWM
	CALL SHIFT_L
	DJNZ R5,S2
	
	MOV DPTR,#K3
	CALL LOAD
	MOV R5,#100
S3:
	CALL LOAD_PWM
	CALL SHIFT_R
	DJNZ R5,S3
	
	
	MOV DPTR,#K3
	CALL LOAD
	MOV R5,#100
S4:
	CALL LOAD_PWM
	CALL SHIFT_L
	DJNZ R5,S4

	MOV DPTR,#K4
	CALL LOAD
	MOV R5,#100
S5:
	CALL LOAD_PWM
	CALL SHIFT_L
	DJNZ R5,S5


	MOV DPTR,#K4
	CALL LOAD
	MOV R5,#100
S6:
	CALL LOAD_PWM
	CALL SHIFT_R
	DJNZ R5,S6
JMP MAIN




LOAD_PWM:
		 MOV R6,#20
L_LOAD_PWM:
		CALL PWM8C
		DJNZ R6,L_LOAD_PWM
		RET
;========================================
PWM8C:
		MOV R3,#255
		MOV P1,#255
		
LOOP_PWM:
		DJNZ R3,CONT0
		MOV P1,#255
		MOV P3,#255
		JMP EX_PWM
CONT0:
		MOV A,R3	
		CJNE A,MT1,CONT1
		CLR P1.0
		CLR P3.0
CONT1:
		CJNE A,MT2,CONT2
		CLR P1.1
		CLR P3.1
CONT2:
		CJNE A,MT3,CONT3
		CLR P1.2
		CLR P3.2
CONT3:
		CJNE A,MT4,CONT4
		CLR P1.3
		CLR P3.3
CONT4:
		CJNE A,MT5,CONT5
		CLR P1.4
		CLR P3.4
CONT5:
		CJNE A,MT6,CONT6
		CLR P1.5
		CLR P3.5
CONT6:
		CJNE A,MT7,CONT7
		CLR P1.6
		CLR P3.6
CONT7:
		CJNE A,MT8,CONT8
		CLR P1.7
		CLR P3.7
CONT8:
		JMP LOOP_PWM
EX_PWM:
		RET
;===========================================		
SHIFT_L:
		MOV R7,MT1
		MOV R0,#MT2
		MOV R1,#MT1
LOOP_SHIFT_L:		
		
		MOV A,@R0
		MOV @R1,A
		INC R1
		INC R0
		CJNE R1,#MT8,LOOP_SHIFT_L
		MOV MT8,R7
		RET


;==========================================
SHIFT_R:
		MOV R7,MT8
		MOV R0,#MT7
		MOV R1,#MT8
LOOP_SHIFT_R:		
		
		MOV A,@R0
		MOV @R1,A
		DEC R1
		DEC R0
		CJNE R1,#MT1,LOOP_SHIFT_R
		MOV MT1,R7
		RET
;==========================================
LOAD:
		MOV R0,#MT1
LOOP_LOAD:
		MOV A,#0
		MOVC A,@A+DPTR
		MOV @R0,A
		INC R0
		INC DPTR
		CJNE R0,#(MT8+1),LOOP_LOAD
		RET
;==========================================		
		
K1:
	DB 2,15,30,60,100,150,200,254
K2:
	DB 20,20,20,254,10,20,20,254
K3:
	DB 2,20,100,254,254,100,20,2
K4:
	DB 254,50,5,5,5,5,50,254

END