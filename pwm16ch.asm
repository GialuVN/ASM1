
; pwm 16kenh
;ung dung den jot (p1 va p3) tac dong muc thap


ORG 0


MT1	EQU 30H
MT2 EQU 31H
MT3	EQU 32H
MT4 EQU 33H
MT5	EQU 34H
MT6 EQU 35H
MT7	EQU 36H
MT8 EQU 37H
MT9	EQU 38H
MT10 EQU 39H
MT11 EQU 3AH
MT12 EQU 3BH
MT13 EQU 3CH
MT14 EQU 3DH
MT15 EQU 3EH
MT16 EQU 3FH

STEPA EQU 41H
BEGIN:

MOV MT1,#0
MOV MT2,#0
MOV MT3,#0
MOV MT4,#0
MOV MT5,#0
MOV MT6,#0
MOV MT7,#0
MOV MT8,#254
MOV MT9,#128
MOV MT10,#64
MOV MT11,#32
MOV MT12,#16
MOV MT13,#8
MOV MT14,#2
MOV MT15,#1
MOV MT16,#0

MOV R0,#MT16+1
LOOP_:
MOV @R0,#0
INC R0
CJNE R0,#MT16+17,LOOP_

MOV P1,#255
MOV P3,#255




MAIN:
CALL LOAD_PWM
CALL SHIFT_L
JMP MAIN




LOAD_PWM:
		 MOV R6,#5
L_LOAD_PWM:
		CALL PWM8C
		DJNZ R6,L_LOAD_PWM
		RET
;========================================
PWM8C:
		MOV R3,#255
		
		MOV P1,#255
		MOV P3,#255
		
LOOP_PWM:
		DJNZ R3,CONT0
		MOV P1,#255
		MOV P3,#255
		JMP EX_PWM
CONT0:
		MOV A,R3	
		CJNE A,MT1,CONT1
		CLR P1.0
CONT1:
		CJNE A,MT2,CONT2
		CLR P1.1
CONT2:
		CJNE A,MT3,CONT3
		CLR P1.2
CONT3:
		CJNE A,MT4,CONT4
		CLR P1.3
CONT4:
		CJNE A,MT5,CONT5
		CLR P1.4
CONT5:
		CJNE A,MT6,CONT6
		CLR P1.5
CONT6:
		CJNE A,MT7,CONT7
		CLR P1.6
CONT7:
		CJNE A,MT8,CONT8
		CLR P1.7
CONT8:
		CJNE A,MT9,CONT9
		CLR P3.0
CONT9:
		CJNE A,MT10,CONT10
		CLR P3.1
CONT10:
		CJNE A,MT11,CONT11
		CLR P3.2
CONT11:
		CJNE A,MT12,CONT12
		CLR P3.3
CONT12:
		CJNE A,MT13,CONT13
		CLR P3.4
CONT13:
		CJNE A,MT14,CONT14
		CLR P3.5
CONT14:
		CJNE A,MT15,CONT15
		CLR P3.6
CONT15:
		CJNE A,MT16,CONT16
		CLR P3.7
CONT16:
		JMP LOOP_PWM
EX_PWM:
		RET
;===========================================		
SHIFT_L:
		MOV R7,MT1
		MOV R0,#MT2
		MOV R1,#MT1
LOOP_SHIFT_L:		
		
		MOV A,@R0
		MOV @R1,A
		INC R1
		INC R0
		CJNE R1,#(16+MT16),LOOP_SHIFT_L
		MOV (16+MT16),R7
		RET


;==========================================
SHIFT_R:
		MOV R7,MT16
		MOV R0,#MT15
		MOV R1,#MT16
LOOP_SHIFT_R:		
		
		MOV A,@R0
		MOV @R1,A
		DEC R1
		DEC R0
		CJNE R1,#MT1,LOOP_SHIFT_R
		MOV MT1,R7
		RET
;==========================================
LOAD:
		MOV R0,#MT1
LOOP_LOAD:
		MOV A,#0
		MOVC A,@A+DPTR
		MOV @R0,A
		INC R0
		INC DPTR
		CJNE R0,#(MT16+1),LOOP_LOAD
		RET
;==========================================		
		
K1:
	DB 2,15,30,60,100,150,200,254
K2:
	DB 20,20,20,254,10,20,20,254
K3:
	DB 2,20,100,254,254,100,20,2
K4:
	DB 254,50,5,5,5,5,50,254

END