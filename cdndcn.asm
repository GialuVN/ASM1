ORG 0
C01 BIT P0.0
C02 BIT P0.1
C03 BIT P0.2
C04 BIT P0.3
C05 BIT P0.4
C06 BIT P0.5
C07 BIT P0.6
C08 BIT P0.7

C09 BIT P1.0
C10 BIT P1.1
C11 BIT P1.2
C12 BIT P1.3
C13 BIT P1.4
C14 BIT P1.5
C15 BIT P1.6
C16 BIT P1.7

C17 BIT P2.0
C18 BIT P2.1
C19 BIT P2.2
C20 BIT P2.3
;=============
C21 BIT P2.4
C22 BIT P2.5
C23 BIT P2.6
C24 BIT P2.7

C25 BIT P3.0
C26 BIT P3.1
C27 BIT P3.2
C28 BIT P3.3
C29 BIT P3.4
C30 BIT P3.5
C31 BIT P3.6
C32 BIT P3.7

P00 EQU 20H
P11 EQU 21H
P22 EQU 22H
P33 EQU 23H

BEGIN:
MOV P0,#0
MOV P1,#0
MOV P2,#0
MOV P3,#0
MOV P00,#0
MOV P11,#0
MOV P22,#0
MOV P33,#0
MAIN:

CALL CHOP_CHOP
CALL VAO_RA
CALL SAU_BO
CALL XEN_KE2
CALL SANG_DON
CALL XEN_KE
JMP MAIN



CHOP_CHOP:
	MOV R0,#5
L_CHOP_CHOP:
	CALL SANG_HET
	CALL DELAY250MS
	CALL TAT_HET
	CALL DELAY250MS	
	DJNZ R0,L_CHOP_CHOP
	
	RET
	
XEN_KE:
	MOV R0,#10
L_XEN_KE:
	MOV P0,#10101010B
	MOV P1,#01010101B
	MOV P2,#10101010B
	MOV P3,#01010101B
	CALL DELAY100MS
	MOV P0,#01010101B
	MOV P1,#10101010B
	MOV P2,#01010101B
	MOV P3,#10101010B
	CALL DELAY100MS
	DJNZ R0,L_XEN_KE
	RET
	
SAU_BO:
	MOV R0,#20
L_SAU_BO:
	MOV A,#10001000B
	MOV P0,A
	MOV P1,A
	MOV P2,A
	MOV P3,A
	CALL DELAY50MS
	MOV A,#01000100B
	MOV P0,A
	MOV P1,A
	MOV P2,A
	MOV P3,A
	CALL DELAY50MS
	MOV A,#00100010B
	MOV P0,A
	MOV P1,A
	MOV P2,A
	MOV P3,A
	CALL DELAY50MS	
	MOV A,#00010001B
	MOV P0,A
	MOV P1,A
	MOV P2,A
	MOV P3,A
	CALL DELAY50MS	
	DJNZ R0,L_SAU_BO
	RET
	
VAO_RA:
	CALL SANG_H2
	CALL TAT_H1
	MOV R0,#10
L_VAO_RA:
	SETB C01
	CLR C20
	CALL DELAY50MS
	CLR C01
	SETB C20
	CALL DELAY50MS
	DJNZ R0,L_VAO_RA
	
	SETB C01
	SETB C20
	CALL DELAY150MS
	CLR C01
	CLR C20
	SETB C02
	SETB C19
	CALL DELAY150MS
	CLR C02
	CLR C19
	SETB C03
	SETB C18
	CALL DELAY150MS
	CLR C03
	CLR C18
	SETB C04
	SETB C17
	CALL DELAY150MS
	CLR C04
	CLR C17
	SETB C05
	SETB C16
	CALL DELAY150MS
	CLR C05
	CLR C16
	SETB C06
	SETB C15
	CALL DELAY150MS
	CLR C06
	CLR C15
	SETB C07
	SETB C14
	CALL DELAY150MS
	CLR C07
	CLR C14
	SETB C08
	SETB C13
	CALL DELAY150MS
	CLR C08
	CLR C13
	SETB C09
	SETB C12
	CALL DELAY150MS
	CLR C09
	CLR C12
	SETB C10
	SETB C11
	CALL DELAY150MS
	MOV R0,#10
L_VR1:
	SETB C10
	CLR C11
	CALL DELAY50MS
	CLR C10
	SETB C11
	CALL DELAY50MS
	DJNZ R0,L_VR1
	SETB C10
	SETB C11
	CALL DELAY50MS
	SETB C09
	SETB C12
	CALL DELAY50MS
	SETB C08
	SETB C13
	CALL DELAY50MS
	SETB C07
	SETB C14
	CALL DELAY50MS
	SETB C06
	SETB C15
	CALL DELAY50MS
	SETB C05
	SETB C16
	CALL DELAY50MS
	SETB C04
	SETB C17
	CALL DELAY50MS
	SETB C03
	SETB C18
	CALL DELAY50MS
	SETB C02
	SETB C19
	CALL DELAY50MS
	SETB C01
	SETB C20
	CALL DELAY250MS
	CLR C11
	CLR C10
	CLR C21
	CLR C32
	CALL DELAY50MS
	CLR C09
	CLR C12
	CLR C22
	CLR C31
	CALL DELAY50MS
	CLR C08
	CLR C13
	CLR C23
	CLR C30
	CALL DELAY50MS
	CLR C07
	CLR C14
	CLR C24
	CLR C29
	CALL DELAY50MS
	CLR C06
	CLR C15
	CLR	C25
	CLR C28
	CALL DELAY50MS
	CLR C05
	CLR C16
	CLR C26
	CLR C27
	CALL DELAY50MS
	CLR C04
	CLR C17
	CALL DELAY50MS
	CLR C03
	CLR C18
	CALL DELAY50MS
	CLR C02
	CLR C19
	CALL DELAY50MS
	CLR C01
	CLR C20
	CALL DELAY200MS
	RET


SANG_DON:
	MOV 40H,#8
	MOV R7,#0FFH
LAP2:
	MOV A,#0FEH
	MOV R6,40H
LAP:
	PUSH ACC
	ANL A,R7
	CPL A
	MOV P1,A
	MOV P3,A
	MOV P0,A
	MOV P2,A
	POP ACC
	RL A
	CALL DELAY100MS
	DJNZ R6,LAP
	DEC 40H
	MOV A,R7
	CLR C
	RRC A
	MOV R7,A
	CJNE A,#0,LAP2
	CALL DELAY200MS
	MOV 40H,#8
	MOV R7,#0FFH
LAP3:
	MOV A,#0FEH
	MOV R6,40H
LAP4:
	PUSH ACC
	ANL A,R7
	CPL A
	MOV P1,A
	MOV P3,A
	MOV P0,A
	MOV P2,A
	POP ACC
	RR A
	CALL DELAY100MS
	DJNZ R6,LAP4
	DEC 40H
	MOV A,R7
	CLR c
	RLC A
	MOV R7,A
	CJNE A,#0,LAP3
	CALL DELAY200MS
	RET











XEN_KE2:
	MOV R0,#20
L_XEN_KE2:
	CALL SANG_H1
	CALL TAT_H2
	CALL DELAY50MS
	CALL TAT_H1
	CALL SANG_H2
	CALL DELAY50MS
	DJNZ R0,L_XEN_KE2
	RET









SANG_HET:
	MOV P3,#255
	MOV P0,#255
	MOV P1,#255
	MOV P2,#255
	RET
TAT_HET:
	MOV P1,#0
	MOV P2,#0
	MOV P3,#0
	MOV P0,#0
	RET
;---------------------	
SANG_H1:
	MOV P1,#255
	MOV P0,#255
	SETB C17
	SETB C18
	SETB C19
	SETB C20
	RET
TAT_H1:
	MOV P1,#0
	MOV P0,#0
	CLR  C17
	CLR  C18
	CLR  C19
	CLR  C20
	RET	
;---------------------
SANG_H2:
	SETB C21
	SETB C22
	SETB C23
	SETB C24
	MOV P3,#255
	RET
TAT_H2:	
	CLR C21
	CLR C22
	CLR C23
	CLR C24
	MOV P3,#0
	RET

;-------------------------

DELAY500MS:
		CALL DELAY250MS
		CALL DELAY250MS
		RET
DELAY250MS:
		CALL DELAY50MS
		CALL DELAY200MS
		RET
DELAY200MS:
		CALL DELAY100MS
		CALL DELAY100MS
		RET
DELAY150MS:
		CALL DELAY50MS
		CALL DELAY100MS
		RET		
DELAY100MS:
		CALL DELAY50MS
		CALL DELAY50MS
		RET
DELAY50MS:
		CALL DELAY25MS
		CALL DELAY25MS
		RET
DELAY25MS:
	MOV 30H,#100
L_DELAY25MS:
	MOV 31H,#249
	DJNZ 31H,$
	DJNZ 30H,L_DELAY25MS
	RET

	END