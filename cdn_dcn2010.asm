
C01 BIT P0.0
C02 BIT P0.1
C03 BIT P0.2
C04 BIT P0.3
C05 BIT P0.4
C06 BIT P0.5
C07 BIT P0.6
C08 BIT P0.7



C09 BIT P2.7
C10 BIT P2.6
C11 BIT P2.5
C12 BIT P2.4
C13 BIT P2.3
C14 BIT P2.2
C15 BIT P2.1
C16 BIT P2.0

C17 BIT P3.7
C18 BIT P3.6
C19 BIT P3.5
C20 BIT P3.4
C21 BIT P3.3
C22 BIT P3.2
C23 BIT P3.1
C24 BIT P3.0

C25 BIT P1.7
C26 BIT P1.6
C27 BIT P1.5
C28 BIT P1.4
C29 BIT P1.3
C30 BIT P1.2
C31 BIT P1.1
C32 BIT P1.0





;===bien dieu khien do RONG XUNG======
MT01 EQU 30H
MT02 EQU 31H
MT03 EQU 32H
MT04 EQU 33H
MT05 EQU 34H
MT06 EQU 35H
MT07 EQU 36H
MT08 EQU 37H
MT09 EQU 38H
MT10 EQU 39H
MT11 EQU 3AH
MT12 EQU 3BH
MT13 EQU 3CH
MT14 EQU 3DH

MT15 EQU 3EH
MT16 EQU 3FH
MT17 EQU 40H
MT18 EQU 41H
MT19 EQU 42H
MT20 EQU 43H
MT21 EQU 44H
MT22 EQU 45H

MT23 EQU 46H
MT24 EQU 47H
MT25 EQU 48H
MT26 EQU 49H
MT27 EQU 4AH
MT28 EQU 4BH

MT29 EQU 4CH
MT30 EQU 4DH
MT31 EQU 4EH
MT32 EQU 4FH
MT33 EQU 50H
MT34 EQU 51H
MT35 EQU 52H
MT36 EQU 53H

MT37 EQU 54H
MT38 EQU 55H
MT39 EQU 56H
MT40 EQU 57H

;==========BIEN DIEU KHIEN==============
RESOL  EQU 64		;DO PHAN GIAI
SPEED  EQU 60H
STEP   EQU 61H		;BUOC NHAY CON TRO
APOS   EQU 62H
BPOS   EQU 63H
SLE_MT EQU 64H
COUNT  EQU 65H
TEM1   EQU 66H
BACK   EQU 67H		
RX1    EQU 68H		;BIEN TAM DA DUNG	
RX2	   EQU 69H



;===================









P00 EQU 21H
P11 EQU 22H
P22 EQU 23H
P33 EQU 24H
;DINH NGHIA BIT
TEM2  DATA 20H
T1X   	BIT  TEM2.0
T2X 	BIT  TEM2.1
T4X		BIT	 TEM2.2
T8X		BIT  TEM2.3
T16X	BIT  TEM2.4
T32X    BIT  TEM2.5
T64X    BIT  TEM2.6
T128X   BIT  TEM2.7
;~~~~~~~~BEGIN~~~~~~~~
ORG		0000H
JMP		BEGIN
ORG		0001BH
MOV TH1,#HIGH(-10000)
MOV TL1,#LOW (-10000)
INC TEM2
MOV R7,TEM2
CJNE R7,#255,EX_INT
MOV TEM2,#0
EX_INT:
RETI

BEGIN:

CALL DELAY4X
MOV DPTR,#LOW_ALL
MOV APOS,#MT01
MOV BPOS,#MT32
CALL LOAD_MT
MOV IE,#88H				;CHO PHEP NGAT DO BO DINH THOI 1
MOV TMOD,#10H			; TIMER 1 CHE DO 16BIT
MOV TEM1,#0
SETB TR1
SETB TF1

MOV P0,#0
MOV P1,#0
MOV P2,#0
MOV P3,#0
MOV P00,#0
MOV P11,#0
MOV P22,#0
MOV P33,#0
MAIN:
CLR IE.7
CALL RIPA

CALL EFF7
CALL EFF8

CALL EFF5
CALL EFF6
CALL EFF5
CALL EFF6

CALL RIPA

CALL EFF1
CALL EFF2

CALL EFF3
CALL EFF4
jmp main
SETB IE.7


CALL KK1

CALL DELAY500MS
CALL CHOP_CHOP
MOV R3,#10

LK1:
CALL SANGT_DAN_PWM
DJNZ R3,LK1
CALL XEN_KE
CALL VAO_RA

MOV R3,#20

LK2:
CALL XEN2_KE_PWM
DJNZ R3,LK2
CALL XEN_KE2
CALL CHOP_CHOP
MOV R3,#30

LK3:
CALL XEN_KE_PWM
DJNZ R3,LK3
CALL XEN_KE2
CALL KK1
JMP MAIN









;==========================================================



STYLE1:
	CALL EFF1
	MOV SPEED,#255
	CALL PWM_SP
	MOV DPTR,#RIPLE1
	CALL RIP
	CALL EFF8
	MOV SPEED,#255
	CALL PWM_SP
	MOV DPTR,#RIPLE2
	CALL RIP
	MOV R3,#3
LST1:
	CALL EFF5
	CALL EFF6		
	DJNZ R3,LST1
	MOV DPTR,#RIPLE3
	CALL RIP
	MOV DPTR,#RIPLE4
	CALL RIP	
	CALL EFF7
	MOV SPEED,#255
	CALL PWM_SP	
	CALL EFF2
	MOV SPEED,#255
	CALL PWM_SP	
	MOV DPTR,#RIPLE6
	CALL RIP	
	CALL EFFX1
	CALL EFF8
	MOV SPEED,#255
	CALL PWM_SP	
	MOV DPTR,#RIPLE5
	CALL RIP
	CALL EFF3
	MOV SPEED,#255
	CALL PWM_SP		
	CALL EFF4
	MOV DPTR,#RIPLE7
	CALL RIP
	
	RET
		
		
		





RIPA:
	  MOV DPTR,#RIPLE8
	  CALL RIP	
	RET


RIP:
	MOV APOS,#MT01
	MOV BPOS,#MT32
	CALL LOAD_MT
	MOV SPEED,#30
	MOV R3,#64
L_RIP:
	CALL LEFT
	CALL PWM_SP
	DJNZ R3,L_RIP
	MOV R3,#64
L2_RIP:
	CALL RIGHT
	CALL PWM_SP
	DJNZ R3,L2_RIP
	RET
	
;======PWM CO CHINH TOC DO BIEN "SPEED"==================
PWM_SP:
		PUSH SPEED
R_PWM_SP:	
		CALL PWM_16C
		DJNZ SPEED,R_PWM_SP
		POP SPEED
		RET
;============CHUONG TRINH CON PHAT PWM===================
PWM_16C:
		PUSH 00H
		PUSH ACC
		MOV R0,#RESOL
		MOV P0,#0
		MOV P1,#0
		MOV P2,#0
		MOV P3,#0
		JMP CONT0
LOOP_PWM:
		DJNZ R0,CONT0
		MOV P0,#0
		MOV P1,#0
		MOV P2,#0
		MOV P3,#0
		JMP EX_PWM
CONT0:
		MOV A,R0	
		CJNE A,MT01,CONT1
		SETB C01
CONT1:
		CJNE A,MT02,CONT2
		SETB C02
CONT2:
		CJNE A,MT03,CONT3
		SETB C03
CONT3:
		CJNE A,MT04,CONT4
		SETB C04
CONT4:
		CJNE A,MT05,CONT5
		SETB C05
CONT5:
		CJNE A,MT06,CONT6
		SETB C06
CONT6:
		CJNE A,MT07,CONT7
		SETB C07
CONT7:
		CJNE A,MT08,CONT8
		SETB C08
CONT8:
		CJNE A,MT09,CONT9
		SETB C09
CONT9:
		CJNE A,MT10,CONT10
		SETB C10
CONT10:
		CJNE A,MT11,CONT11
		SETB C11
CONT11:
		CJNE A,MT12,CONT12
		SETB C12
CONT12:
		CJNE A,MT13,CONT13
		SETB C13
CONT13:
		CJNE A,MT14,CONT14
		SETB C14
CONT14:

		CJNE A,MT15,CONT15
		SETB C15
CONT15:
		CJNE A,MT16,CONT16
		SETB C16
CONT16:
		CJNE A,MT17,CONT17
		SETB C17
CONT17:
		CJNE A,MT18,CONT18
		SETB C18
CONT18:
		CJNE A,MT19,CONT19
		SETB C19
CONT19:
		CJNE A,MT20,CONT20
		SETB C20
CONT20:
		CJNE A,MT21,CONT21
		SETB C21
CONT21:
		CJNE A,MT22,CONT22
		SETB C22
CONT22:
		CJNE A,MT23,CONT23
		SETB C23
CONT23:
		CJNE A,MT24,CONT24
		SETB C24
CONT24:
		CJNE A,MT25,CONT25
		SETB C25
CONT25:
		CJNE A,MT26,CONT26
		SETB C26
CONT26:
		CJNE A,MT27,CONT27
		SETB C27
CONT27:
		CJNE A,MT28,CONT28
		SETB C28
CONT28:
		CJNE A,MT29,CONT29
		SETB C29
CONT29:
		CJNE A,MT30,CONT30
		SETB C30
CONT30:
		CJNE A,MT31,CONT31
		SETB C31
CONT31:
		CJNE A,MT32,CONT32
		SETB C32
CONT32:
		JMP LOOP_PWM
EX_PWM:
		POP ACC
		POP 00H
		RET
		
;=====HIEU UNG======================
EFFX1:
	MOV APOS,#MT01
	MOV BPOS,#MT32
	MOV SPEED,#20
	MOV BACK,#6
	CALL LOAD_F
	
	MOV RX1,#MT32
	DEC RX1
	MOV R3,#31
L2_EFFX1:	
	MOV SLE_MT,#MT01
	MOV DPTR,#T_INC1
	MOV COUNT,#8
	MOV SPEED,#20
	CALL LOAD_	
	
	MOV APOS,#MT01
	MOV BPOS,RX1
	MOV SPEED,#10
	MOV RX2,R3
L_EFFX1:
	CALL RIGHT
	CALL PWM_SP
	DJNZ RX2,L_EFFX1	
	DEC	R3
	DEC RX1
	MOV A,RX1
	CJNE A,#MT01-1,L2_EFFX1
	MOV COUNT,#8
	MOV SPEED,#2O
	CALL LOAD_	
	RET
;>TAT CA LED TAT
;>SANG TU TU TUNG LED
;>TU TRAI SANG PHAI
EFF1:
		MOV DPTR,#LOW_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT32
		CALL LOAD_MT
		MOV SLE_MT,APOS
		MOV SPEED,#10
		MOV COUNT,#8
		MOV DPTR,#T_INC1
L_EFF1:		
		CALL LOAD_
		INC SLE_MT
		MOV A,SLE_MT
		MOV TEM1,BPOS
		INC TEM1
		CJNE A,TEM1,L_EFF1
		RET

;>TAT CA LED SANG
;>SANG TU TU TUNG LED
;>TU TRAI SANG PHAI
		
EFF2:
		MOV DPTR,#HIGH_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT32
		CALL LOAD_MT
		
		MOV SLE_MT,APOS
		MOV SPEED,#10
		MOV COUNT,#8
		MOV DPTR,#T_DEC1
L_EFF2:		
		CALL LOAD_
		INC SLE_MT
		MOV A,SLE_MT
		MOV TEM1,BPOS
		INC TEM1
		CJNE A,TEM1,L_EFF2
		RET	

;>TAT CA LED TAT
;>LED SANG TUNG MUC
;>TU TRAI SANG PHAI	
		
EFF3:
		MOV DPTR,#LOW_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT32
		CALL LOAD_MT
		
		MOV SPEED,#10
		MOV COUNT,#1
		MOV DPTR,#T_INC1
		MOV R5,#8
L2_EFF3:
		MOV SLE_MT,APOS
L_EFF3:		
		CALL LOAD_
		INC SLE_MT
		MOV A,SLE_MT
		MOV TEM1,BPOS
		INC TEM1
		CJNE A,TEM1,L_EFF3
		INC DPTR
		DJNZ R5,L2_EFF3
		RET	
;>TAT CA LED SANG
;>LED TAT TUNG MUC
;>TU TRAI SANG PHAI			
					
			
EFF4:
		MOV DPTR,#HIGH_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT32
		CALL LOAD_MT
		
		MOV SPEED,#10
		MOV COUNT,#1
		MOV DPTR,#T_DEC1
		MOV R5,#8
L2_EFF4:
		MOV SLE_MT,APOS
L_EFF4:		
		CALL LOAD_
		INC SLE_MT
		MOV A,SLE_MT
		MOV TEM1,BPOS
		INC TEM1
		CJNE A,TEM1,L_EFF4
		INC DPTR
		DJNZ R5,L2_EFF4
		RET							
;>TAT CA LED TAT
;>SAO BANG TU TRAI SANG PHAI

EFF5:
		MOV DPTR,#LOW_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT40
		CALL LOAD_MT
		
		MOV DPTR,#T_INC1
		MOV APOS,#MT33
		MOV BPOS,#MT40
		CALL LOAD_MT
		
		MOV APOS,#MT01
		MOV BPOS,#MT40
		MOV SPEED,#20
		MOV R4,#32
L1_EFF5:		
		CALL RIGHT
		CALL PWM_SP
		DJNZ R4,L1_EFF5
		
		MOV R4,#8
L2_EFF5:		
		CALL RIGHT
		MOV R0,#MT32
		MOV @R0,#64
		CALL PWM_SP
		DJNZ R4,L2_EFF5
		RET
;>TAT CA LED TAT
;>SAO BANG TU PHAI SANG TRAI
	
EFF6:
		MOV DPTR,#LOW_ALL
		MOV APOS,#MT01
		MOV BPOS,#MT40
		CALL LOAD_MT
		
		MOV DPTR,#T_DEC1
		MOV APOS,#MT33
		MOV BPOS,#MT40
		CALL LOAD_MT
		
		MOV APOS,#MT01
		MOV BPOS,#MT40
		MOV SPEED,#20
		MOV R4,#32
L1_EFF6:		
		CALL LEFT
		CALL PWM_SP
		DJNZ R4,L1_EFF6
		
		MOV R4,#8
L2_EFF6:		
		CALL LEFT
		MOV R0,#MT01
		MOV @R0,#64
		CALL PWM_SP
		DJNZ R4,L2_EFF6
		RET
;SANG DAN TAT CA LED
EFF7:
		MOV DPTR,#T_INC1
		MOV APOS,#MT01
		MOV BPOS,#MT32
		MOV COUNT,#8
		MOV SPEED,#50
		CALL LOAD_D
		RET
;TAT DAN TAT CA LED		
EFF8:
		MOV DPTR,#T_DEC1
		MOV APOS,#MT01
		MOV BPOS,#MT32
		MOV COUNT,#8
		MOV SPEED,#50
		CALL LOAD_D
		RET	
;===========CHINH DO SANG TUNG LED==========
;DPTR
;COUNT
;SLE_MT
;SPEED
;CALL LOAD_

LOAD_:
		PUSH 00H
		PUSH DPH
		PUSH DPL
		PUSH COUNT
		
		MOV R0,SLE_MT
L_LOAD_:	
		MOV A,#0
		MOVC A,@A+DPTR
		MOV @R0,A
		INC DPTR
		CALL PWM_SP
		DJNZ COUNT,L_LOAD_
	
		POP COUNT
		POP DPL
		POP DPH
		POP 00H
		RET
		
;========CHINH DO SANG TAT CA LED [ROM]============
;DPTR
;APOS
;BPOS
;COUNT
;SPEED
;CALL LOAD_D	
LOAD_D:
		PUSH 00H
		PUSH 01H
		PUSH DPH
		PUSH DPL
		PUSH COUNT
			
L_LOAD_D:	
		MOV R0,APOS
		MOV A,#0
		MOVC A,@A+DPTR
		MOV R1,A
		MOV TEM1,BPOS
		INC TEM1
L2_LOAD_D:
		MOV A,R1		
		MOV @R0,A
		INC R0
		MOV R1,A
		MOV A,R0
		CJNE A,TEM1,L2_LOAD_D
		CALL PWM_SP
		INC DPTR
		DJNZ COUNT,L_LOAD_D
		
		POP COUNT
		POP DPL
		POP DPH
		POP 01H
		POP 00H
		RET
		
		
;===========CHINH DO SANG TAT CA LED [RAM]=============
;BACK
;APOS
;BPOS
;SPEED
;CALL LOAD_F
LOAD_F:
		PUSH 00H
		PUSH TEM1
		
		MOV TEM1,BPOS
		INC TEM1
		MOV R0,APOS
L_LOAD_F:		
		MOV A,BACK
		MOV @R0,A
		CALL PWM_SP
		INC R0
		MOV A,R0
		CJNE A,TEM1,L_LOAD_F	
			
		POP TEM1
		POP 00H			
		RET

;==========TAI DO RONG XUNG=======================
;DPTR
;APOS
;BPOS
;CALL LOAD_MT
;USING[ APOS = ADRESS1, BPOS = ADRESS2]
LOAD_MT:
		PUSH 00H
		PUSH TEM1
		MOV TEM1,BPOS
		INC TEM1
		MOV R0,APOS
RE_LOAD_MT:	
		MOV A,#0
		MOVC A,@A+DPTR
		MOV @R0,A
		INC R0
		INC DPTR
		MOV A,R0
		CJNE A,TEM1,RE_LOAD_MT
		
		POP TEM1
		POP 00H
		RET
;========QUAY TRAI===================
;APOS
;BPOS
;CALL LEFT
;USING[ APOS = ADRESS1, BPOS = ADRESS2]
LEFT:
		PUSH 00H
		PUSH 01H
		PUSH 02H
		PUSH APOS
		
		MOV R0,APOS
		MOV A,@R0
		MOV R2,A
		MOV R0,APOS
		INC APOS
		MOV R1,APOS
_LEFT:		
		MOV A,@R1
		MOV @R0,A
		INC R0
		INC R1
		MOV A,R0
		CJNE A,BPOS,_LEFT
		MOV R0,BPOS
		MOV A,R2
		MOV @R0,A
		POP APOS
		POP 02H
		POP 01H
		POP 00H
		RET		
;======QUAY PHAI================
;APOS
;BPOS
;CALL RIGHT
;USING[ APOS = ADRESS1, BPOS = ADRESS2]
RIGHT:
		PUSH 00H
		PUSH 01H
		PUSH 02H
		PUSH BPOS
		
		MOV R0,BPOS
		MOV A,@R0
		MOV R2,A
		
		MOV R0,BPOS
		DEC BPOS
		MOV R1,BPOS
_RIGHT:		
		MOV A,@R1
		MOV @R0,A
		DEC R0
		DEC R1
		MOV A,R0
		CJNE A,APOS,_RIGHT
		
		MOV R0,APOS
		MOV A,R2
		MOV @R0,A
		
		POP BPOS
		POP 02H
		POP 01H
		POP 00H
		RET		
;====================================
;========GIAM DPTR [DPTR-STEP]======
DEC_DPTR:
		CLR C
		MOV A,DPL
		SUBB A,STEP
		MOV DPL,A
		MOV A,DPH
		SUBB A,#0
		MOV DPH,A
		RET
;=======TANG DPTR [DPTR+STEP]==========
INC_DPTR:
		MOV A,DPL
		ADD A,STEP
		MOV DPL,A
		MOV A,DPH
		ADDC A,#0
		MOV DPH,A
		RET
;==========================================
DELAY:
		PUSH 01H
		PUSH 00H
		MOV R0,#255
L_DELAY:
		MOV R1,#255
		DJNZ R1,$
		DJNZ R0,L_DELAY
		POP 00H
		POP 01H
		RET

;==========================================================
KK1:
		CALL TAT_HET
		SETB C01
		CALL DELAY100MS
		SETB C02
		CALL DELAY100MS
		SETB C03
		CALL DELAY100MS
		SETB C04
		CALL DELAY100MS
		SETB C05
		CALL DELAY100MS
		SETB C06
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT1:
		CALL SANG_KT1
		CALL DELAY25MS
		CALL TAT_KT1
		CALL DELAY25MS
		DJNZ R0,CH_KT1
		CALL SANG_KT1
		
		
		SETB C07
		CALL DELAY100MS
		SETB C08
		CALL DELAY100MS
		SETB C09
		CALL DELAY100MS
		SETB C10
		CALL DELAY100MS
		SETB C11
		CALL DELAY100MS
		SETB C12
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT2:
		CALL SANG_KT2
		CALL DELAY25MS
		CALL TAT_KT2
		CALL DELAY25MS
		DJNZ R0,CH_KT2
		CALL SANG_KT2
		
			
		
	
		SETB C13
		CALL DELAY100MS
		SETB C14
		CALL DELAY100MS
		SETB C15
		CALL DELAY100MS
		SETB C16
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT3:
		CALL SANG_KT3
		CALL DELAY25MS
		CALL TAT_KT3
		CALL DELAY25MS
		DJNZ R0,CH_KT3
		CALL SANG_KT3
		
		
		
		SETB C17
		CALL DELAY100MS
		SETB C18
		CALL DELAY100MS
		SETB C19
		CALL DELAY100MS
		SETB C20
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT4:
		CALL SANG_KT4
		CALL DELAY25MS
		CALL TAT_KT4
		CALL DELAY25MS
		DJNZ R0,CH_KT4
		CALL SANG_KT4
		
		
		
	
		SETB C21
		CALL DELAY100MS
		SETB C22
		CALL DELAY100MS
		SETB C23
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT5:
		CALL SANG_KT5
		CALL DELAY25MS
		CALL TAT_KT5
		CALL DELAY25MS
		DJNZ R0,CH_KT5
		CALL SANG_KT5
		SETB C24
		
		
		SETB C25
		CALL DELAY100MS
		SETB C26
		CALL DELAY100MS
		SETB C27
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT7:
		CALL SANG_KT7
		CALL DELAY25MS
		CALL TAT_KT7
		CALL DELAY25MS
		DJNZ R0,CH_KT7
		CALL SANG_KT7
		SETB C28
		
		
		
		SETB C29
		CALL DELAY100MS
		SETB C30
		CALL DELAY100MS
		SETB C31
		CALL DELAY100MS
		SETB C32
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT9:
		CALL SANG_KT9
		CALL DELAY25MS
		CALL TAT_KT9
		CALL DELAY25MS
		DJNZ R0,CH_KT9
		CALL SANG_KT9
		RET
		
SANGT_DAN_PWM:
		MOV R2,#100
L_1X:
		CALL SANG_HET
		CALL DELAY1X
		CALL TAT_HET
		CALL DELAY_1X
		DJNZ R2,L_1X
		MOV R2,#100
L_2X:
		CALL SANG_HET
		CALL DELAY2X
		CALL TAT_HET
		CALL DELAY_2X
		DJNZ R2,L_2X
		
		
		MOV R2,#100
L_3X:
		CALL SANG_HET
		CALL DELAY3X
		CALL TAT_HET
		CALL DELAY_3X
		DJNZ R2,L_3X
		
		MOV R2,#100
L_4X:
		CALL SANG_HET
		CALL DELAY4X
		CALL TAT_HET
		CALL DELAY_4X
		DJNZ R2,L_4X
		
		
		MOV R2,#100
L_5X:
		CALL SANG_HET
		CALL DELAY5X
		CALL TAT_HET
		CALL DELAY_5X
		DJNZ R2,L_5X
		
		MOV R2,#100
L_1X1:
		CALL TAT_HET
		CALL DELAY1X
		CALL SANG_HET
		CALL DELAY_1X
		DJNZ R2,L_1X1
		MOV R2,#100
L_2X1:
		CALL TAT_HET
		CALL DELAY2X
		CALL SANG_HET
		CALL DELAY_2X
		DJNZ R2,L_2X1
		
		
		MOV R2,#100
L_3X1:
		CALL TAT_HET
		CALL DELAY3X
		CALL SANG_HET
		CALL DELAY_3X
		DJNZ R2,L_3X1
		
		MOV R2,#100
L_4X1:
		CALL TAT_HET
		CALL DELAY4X
		CALL SANG_HET
		CALL DELAY_4X
		DJNZ R2,L_4X1
		
		
		MOV R2,#100
L_5X1:
		CALL TAT_HET
		CALL DELAY5X
		CALL SANG_HET
		CALL DELAY_5X
		DJNZ R2,L_5X1
		RET
	
XEN_KE_PWM:		
		MOV R2,#100
L_1X2:
		CALL TT1
		CALL DELAY1X
		CALL TT2
		CALL DELAY_1X
		DJNZ R2,L_1X2
		MOV R2,#100
L_2X2:
		CALL TT1
		CALL DELAY2X
		CALL TT2
		CALL DELAY_2X
		DJNZ R2,L_2X2
		
		
		MOV R2,#100
L_3X2:
		CALL TT1
		CALL DELAY3X
		CALL TT2
		CALL DELAY_3X
		DJNZ R2,L_3X2
		
		MOV R2,#100
L_4X2:
		CALL TT1
		CALL DELAY4X
		CALL TT2
		CALL DELAY_4X
		DJNZ R2,L_4X2
		
		
		MOV R2,#100
L_5X2:
		CALL TT1
		CALL DELAY5X
		CALL TT2
		CALL DELAY_5X
		DJNZ R2,L_5X2
		
		
		
		MOV R2,#100
L_1X3:
		CALL TT2
		CALL DELAY1X
		CALL TT1
		CALL DELAY_1X
		DJNZ R2,L_1X3
		MOV R2,#100
L_2X3:
		CALL TT2
		CALL DELAY2X
		CALL TT1
		CALL DELAY_2X
		DJNZ R2,L_2X3
		
		
		MOV R2,#100
L_3X3:
		CALL TT2
		CALL DELAY3X
		CALL TT1
		CALL DELAY_3X
		DJNZ R2,L_3X3
		
		MOV R2,#100
L_4X3:
		CALL TT2
		CALL DELAY4X
		CALL TT1
		CALL DELAY_4X
		DJNZ R2,L_4X3
		
		
		MOV R2,#100
L_5X3:
		CALL TT2
		CALL DELAY5X
		CALL TT1
		CALL DELAY_5X
		DJNZ R2,L_5X3	
		
		RET
		
		
TT1:
		CALL SANG_KT1
		CALL TAT_KT2
		CALL SANG_KT3
		CALL TAT_KT4
		CALL SANG_KT5
		CALL TAT_KT7
		CALL SANG_KT9
		SETB C24
		CLR C28	
			
		RET
TT2:
		CALL TAT_KT1
		CALL SANG_KT2
		CALL TAT_KT3
		CALL SANG_KT4
		CALL TAT_KT5
		CALL SANG_KT7
		CALL TAT_KT9
		CLR C24
		SETB C28	
		
		RET
		
		
		
		
XEN2_KE_PWM:		
		MOV R2,#100
L_1X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY1X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_1X
		DJNZ R2,L_1X4
		MOV R2,#100
L_2X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY2X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_2X
		DJNZ R2,L_2X4
		
		
		MOV R2,#100
L_3X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY3X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_3X
		DJNZ R2,L_3X4
		
		MOV R2,#100
L_4X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY4X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_4X
		DJNZ R2,L_4X4
		
		
		MOV R2,#100
L_5X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY5X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_5X
		DJNZ R2,L_5X4
		
		
		
		MOV R2,#100
L_1X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY1X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_1X
		DJNZ R2,L_1X5
		MOV R2,#100
L_2X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY2X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_2X
		DJNZ R2,L_2X5
		
		
		MOV R2,#100
L_3X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY3X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_3X
		DJNZ R2,L_3X5
		
		MOV R2,#100
L_4X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY4X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_4X
		DJNZ R2,L_4X5
		
		
		MOV R2,#100
L_5X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY5X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_5X
		DJNZ R2,L_5X5	
		
		RET		
		
		
		
		
		
		
		
		

CHOP_CHOP:
	MOV R0,#20
L_CHOP_CHOP:
	CALL SANG_HET
	CALL DELAY50MS
	CALL TAT_HET
	CALL DELAY50MS	
	DJNZ R0,L_CHOP_CHOP
	RET
	
XEN_KE:
	MOV R0,#20
L_XEN_KE:
	MOV P0,#10101010B
	MOV P1,#01010101B
	MOV P2,#10101010B
	MOV P3,#01010101B
	CALL DELAY50MS
	MOV P0,#01010101B
	MOV P1,#10101010B
	MOV P2,#01010101B
	MOV P3,#10101010B
	CALL DELAY50MS
	DJNZ R0,L_XEN_KE
	RET
	

	
VAO_RA:
	CALL TAT_H1
	CALL TAT_H2
	SETB C01
	SETB C20
	CALL DELAY50MS
	CLR C01
	CLR C20
	SETB C02
	SETB C19
	CALL DELAY50MS
	CLR C02
	CLR C19
	SETB C03
	SETB C18
	CALL DELAY50MS
	CLR C03
	CLR C18
	SETB C04
	SETB C17
	CALL DELAY50MS
	CLR C04
	CLR C17
	SETB C05
	SETB C16
	CALL DELAY50MS
	CLR C05
	CLR C16
	SETB C06
	SETB C15
	CALL DELAY50MS
	CLR C06
	CLR C15
	SETB C07
	SETB C14
	CALL DELAY50MS
	CLR C07
	CLR C14
	SETB C08
	SETB C13
	CALL DELAY50MS
	CLR C08
	CLR C13
	SETB C09
	SETB C12
	CALL DELAY50MS
	CLR C09
	CLR C12
	SETB C10
	SETB C11
	CALL DELAY50MS
	SETB C10
	SETB C11
	CALL DELAY50MS
	SETB C09
	SETB C12
	CALL DELAY50MS
	SETB C08
	SETB C13
	CALL DELAY50MS
	SETB C07
	SETB C14
	CALL DELAY50MS
	SETB C06
	SETB C15
	CALL DELAY50MS
	SETB C05
	SETB C16
	CALL DELAY50MS
	SETB C04
	SETB C17
	CALL DELAY50MS
	SETB C03
	SETB C18
	CALL DELAY50MS
	SETB C02
	SETB C19
	CALL DELAY50MS
	SETB C01
	SETB C20
	CALL SANG_H2
	CALL DELAY50MS
	CLR C11
	CLR C10
	CLR C21
	CLR C32
	CALL DELAY50MS
	CLR C09
	CLR C12
	CLR C22
	CLR C31
	CALL DELAY50MS
	CLR C08
	CLR C13
	CLR C23
	CLR C30
	CALL DELAY50MS
	CLR C07
	CLR C14
	CLR C24
	CLR C29
	CALL DELAY50MS
	CLR C06
	CLR C15
	CLR	C25
	CLR C28
	CALL DELAY50MS
	CLR C05
	CLR C16
	CLR C26
	CLR C27
	CALL DELAY50MS
	CLR C04
	CLR C17
	CALL DELAY50MS
	CLR C03
	CLR C18
	CALL DELAY50MS
	CLR C02
	CLR C19
	CALL DELAY50MS
	CLR C01
	CLR C20
	CALL DELAY50MS
	RET










XEN_KE2:
	MOV R0,#20
L_XEN_KE2:
	CALL SANG_H1
	CALL TAT_H2
	CALL DELAY50MS
	CALL TAT_H1
	CALL SANG_H2
	CALL DELAY50MS
	DJNZ R0,L_XEN_KE2
	RET









SANG_HET:
	MOV P3,#255
	MOV P0,#255
	MOV P1,#255
	MOV P2,#255
	RET
TAT_HET:
	MOV P1,#0
	MOV P2,#0
	MOV P3,#0
	MOV P0,#0
	RET
;---------------------	
SANG_H1:
	MOV P1,#255
	MOV P0,#255
	SETB C17
	SETB C18
	SETB C19
	SETB C20
	RET
TAT_H1:
	MOV P1,#0
	MOV P0,#0
	CLR  C17
	CLR  C18
	CLR  C19
	CLR  C20
	RET	
;---------------------
SANG_H2:
	SETB C21
	SETB C22
	SETB C23
	SETB C24
	MOV P3,#255
	RET
TAT_H2:	
	CLR C21
	CLR C22
	CLR C23
	CLR C24
	MOV P3,#0
	RET
;-------------------------
SANG_KT1:
	SETB C01
	SETB C02
	SETB C03
	SETB C04
	SETB C05
	SETB C06
	RET

SANG_KT2:
	SETB C07
	SETB C08
	SETB C09
	SETB C10
	SETB C11
	SETB C12
	RET

SANG_KT3:
	SETB C13
	SETB C14
	SETB C15
	SETB C16
	RET

SANG_KT4:
	SETB C17
	SETB C18
	SETB C19
	SETB C20
	RET

SANG_KT5:
	SETB C21
	SETB C22
	SETB C23
	RET
;SANG KT6  SETB C24

SANG_KT7:
	SETB C25
	SETB C26
	SETB C27
	RET
;SANG KT8  SETB C28

SANG_KT9:
	SETB C29
	SETB C30
	SETB C31
	SETB C32
	RET

TAT_KT1:
	CLR C01
	CLR C02
	CLR C03
	CLR C04
	CLR C05
	CLR C06
	RET

TAT_KT2:
	CLR C07
	CLR C08
	CLR C09
	CLR C10
	CLR C11
	CLR C12
	RET

TAT_KT3:
	CLR C13
	CLR C14
	CLR C15
	CLR C16
	RET

TAT_KT4:
	CLR C17
	CLR C18
	CLR C19
	CLR C20
	RET

TAT_KT5:
	CLR C21
	CLR C22
	CLR C23
	RET
;TAT KT6  CLR C24

TAT_KT7:
	CLR C25
	CLR C26
	CLR C27
	RET
;TAT KT8  CLR C28

TAT_KT9:
	CLR C29
	CLR C30
	CLR C31
	CLR C32
	RET
;-------------------------

DELAY500MS:
		CALL DELAY250MS
		CALL DELAY250MS
		RET
DELAY250MS:
		CALL DELAY50MS
		CALL DELAY200MS
		RET
DELAY200MS:
		CALL DELAY100MS
		CALL DELAY100MS
		RET
DELAY150MS:
		CALL DELAY50MS
		CALL DELAY100MS
		RET		
DELAY100MS:
		CALL DELAY50MS
		CALL DELAY50MS
		RET
DELAY50MS:
		CALL DELAY25MS
		CALL DELAY25MS
		RET
DELAY25MS:
	MOV 30H,#100
L_DELAY25MS:
	MOV 31H,#249
	DJNZ 31H,$
	DJNZ 30H,L_DELAY25MS
	RET



DELAY1X:
		NOP
		RET
DELAY2X:
		MOV R0,#50
		DJNZ R0,$
		RET
DELAY3X:
		MOV R0,#100
		DJNZ R0,$
		RET
DELAY4X:
		MOV R0,#200
		DJNZ R0,$
		RET
DELAY5X:
		CALL DELAY4X
		CALL DELAY4X
		RET
		
DELAY_1X:
		CALL DELAY5X
		RET
DELAY_2X:
		CALL DELAY2X
		CALL DELAY3X
		CALL DELAY4X
		RET
DELAY_3X:
		CALL DELAY3X
		CALL DELAY4X
		RET
DELAY_4X:
		CALL DELAY4X
		RET
DELAY_5X:
		CALL DELAY1X
		RET



RIPLE1:
	DB 5,10,20,30,40,50,64,64,50,40,30,20,10,5
RIPLE2:
	DB 5,10,30,64,30,10,5,5,10,30,64,30,10,5
RIPLE3:
	DB 64,59,55,50,46,41,36,31,27,22,18,13,9,4
	
RIPLE4:
	DB 1,2,4,8,16,32,64,1,2,4,8,16,32,64
RIPLE5:
	DB 64,32,16,8,4,2,1,64,32,16,8,4,2,1	
	
RIPLE6:
	DB 1,2,4,8,16,32,64,64,32,16,8,4,2,1
RIPLE7:
	DB 64,32,16,8,4,2,1,2,4,8,16,32,64
RIPLE8:
	DB 5,10,20,30,40,50,64,64,50,40,30,20,10,5,5,10,20,30,40,50,64,64,50,40,30,20,10,5,5,10,20,30

;BUOC TANG/GIAM
T_INC1:
	DB 0,1,2,4,8,16,32,64
T_DEC1:
	DB 64,32,16,8,4,2,1,0
	
T_INC2:
	DB 0,4,8,12,16,18,22,26,30,34,38,42,46,50,54,56,60,64
T_DEC2:
	DB 64,60,56,54,50,46,42,38,34,30,26,22,18,16,12,8,4,0

;THIET LAP BAN DAU
LOW_ALL:
	DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
	
HIGH_ALL:
	DB 64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64
	DB 64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64
END
