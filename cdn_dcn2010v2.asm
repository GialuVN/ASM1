
C01 BIT P0.0
C02 BIT P0.1
C03 BIT P0.2
C04 BIT P0.3
C05 BIT P0.4
C06 BIT P0.5
C07 BIT P0.6
C08 BIT P0.7

C09 BIT P1.0
C10 BIT P1.1
C11 BIT P1.2
C12 BIT P1.3
C13 BIT P1.4
C14 BIT P1.5
C15 BIT P1.6
C16 BIT P1.7

C17 BIT P2.0
C18 BIT P2.1
C19 BIT P2.2
C20 BIT P2.3
;=============
C21 BIT P2.4
C22 BIT P2.5
C23 BIT P2.6
C24 BIT P2.7

C25 BIT P3.0
C26 BIT P3.1
C27 BIT P3.2
C28 BIT P3.3
C29 BIT P3.4
C30 BIT P3.5
C31 BIT P3.6
C32 BIT P3.7




P00 EQU 21H
P11 EQU 22H
P22 EQU 23H
P33 EQU 24H
;DINH NGHIA BIT
TEM1  DATA 20H
T1X   	BIT  TEM1.0
T2X 	BIT  TEM1.1
T4X		BIT	 TEM1.2
T8X		BIT  TEM1.3
T16X	BIT  TEM1.4
T32X    BIT  TEM1.5
T64X    BIT  TEM1.6
T128X   BIT  TEM1.7
;~~~~~~~~BEGIN~~~~~~~~
ORG		0000H
JMP		BEGIN
ORG		0001BH
MOV TH1,#HIGH(-10000)
MOV TL1,#LOW (-10000)
INC TEM1
MOV R7,TEM1
CJNE R7,#255,EX_INT
MOV TEM1,#0
EX_INT:
	RETI

BEGIN:

MOV IE,#88H				;CHO PHEP NGAT DO BO DINH THOI 1
MOV TMOD,#10H			; TIMER 1 CHE DO 16BIT
MOV TEM1,#0
SETB TF1
SETB TR1


MOV P0,#0
MOV P1,#0
MOV P2,#0
MOV P3,#0
MOV P00,#0
MOV P11,#0
MOV P22,#0
MOV P33,#0
MAIN:
CALL KK1
CALL DELAY500MS
CALL CHOP_CHOP
MOV R3,#10

LK1:
CALL SANGT_DAN_PWM
DJNZ R3,LK1
CALL XEN_KE
CALL VAO_RA

MOV R3,#20

LK2:
CALL XEN2_KE_PWM
DJNZ R3,LK2
CALL XEN_KE2
CALL CHOP_CHOP
MOV R3,#30

LK3:
CALL XEN_KE_PWM
DJNZ R3,LK3
CALL XEN_KE2
JMP MAIN








;==========================================================
KK1:
		CALL TAT_HET
		SETB C01
		CALL DELAY100MS
		SETB C02
		CALL DELAY100MS
		SETB C03
		CALL DELAY100MS
		SETB C04
		CALL DELAY100MS
		SETB C05
		CALL DELAY100MS
		SETB C06
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT1:
		CALL SANG_KT1
		CALL DELAY25MS
		CALL TAT_KT1
		CALL DELAY25MS
		DJNZ R0,CH_KT1
		CALL SANG_KT1
		
		
		SETB C07
		CALL DELAY100MS
		SETB C08
		CALL DELAY100MS
		SETB C09
		CALL DELAY100MS
		SETB C10
		CALL DELAY100MS
		SETB C11
		CALL DELAY100MS
		SETB C12
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT2:
		CALL SANG_KT2
		CALL DELAY25MS
		CALL TAT_KT2
		CALL DELAY25MS
		DJNZ R0,CH_KT2
		CALL SANG_KT2
		
			
		
	
		SETB C13
		CALL DELAY100MS
		SETB C14
		CALL DELAY100MS
		SETB C15
		CALL DELAY100MS
		SETB C16
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT3:
		CALL SANG_KT3
		CALL DELAY25MS
		CALL TAT_KT3
		CALL DELAY25MS
		DJNZ R0,CH_KT3
		CALL SANG_KT3
		
		
		
		SETB C17
		CALL DELAY100MS
		SETB C18
		CALL DELAY100MS
		SETB C19
		CALL DELAY100MS
		SETB C20
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT4:
		CALL SANG_KT4
		CALL DELAY25MS
		CALL TAT_KT4
		CALL DELAY25MS
		DJNZ R0,CH_KT4
		CALL SANG_KT4
		
		
		
	
		SETB C21
		CALL DELAY100MS
		SETB C22
		CALL DELAY100MS
		SETB C23
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT5:
		CALL SANG_KT5
		CALL DELAY25MS
		CALL TAT_KT5
		CALL DELAY25MS
		DJNZ R0,CH_KT5
		CALL SANG_KT5
		SETB C24
		
		
		SETB C25
		CALL DELAY100MS
		SETB C26
		CALL DELAY100MS
		SETB C27
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT7:
		CALL SANG_KT7
		CALL DELAY25MS
		CALL TAT_KT7
		CALL DELAY25MS
		DJNZ R0,CH_KT7
		CALL SANG_KT7
		SETB C28
		
		
		
		SETB C29
		CALL DELAY100MS
		SETB C30
		CALL DELAY100MS
		SETB C31
		CALL DELAY100MS
		SETB C32
		CALL DELAY100MS
		
		MOV R0,#10
CH_KT9:
		CALL SANG_KT9
		CALL DELAY25MS
		CALL TAT_KT9
		CALL DELAY25MS
		DJNZ R0,CH_KT9
		CALL SANG_KT9
		RET
		
SANGT_DAN_PWM:
		MOV R2,#100
L_1X:
		CALL SANG_HET
		CALL DELAY1X
		CALL TAT_HET
		CALL DELAY_1X
		DJNZ R2,L_1X
		MOV R2,#100
L_2X:
		CALL SANG_HET
		CALL DELAY2X
		CALL TAT_HET
		CALL DELAY_2X
		DJNZ R2,L_2X
		
		
		MOV R2,#100
L_3X:
		CALL SANG_HET
		CALL DELAY3X
		CALL TAT_HET
		CALL DELAY_3X
		DJNZ R2,L_3X
		
		MOV R2,#100
L_4X:
		CALL SANG_HET
		CALL DELAY4X
		CALL TAT_HET
		CALL DELAY_4X
		DJNZ R2,L_4X
		
		
		MOV R2,#100
L_5X:
		CALL SANG_HET
		CALL DELAY5X
		CALL TAT_HET
		CALL DELAY_5X
		DJNZ R2,L_5X
		
		MOV R2,#100
L_1X1:
		CALL TAT_HET
		CALL DELAY1X
		CALL SANG_HET
		CALL DELAY_1X
		DJNZ R2,L_1X1
		MOV R2,#100
L_2X1:
		CALL TAT_HET
		CALL DELAY2X
		CALL SANG_HET
		CALL DELAY_2X
		DJNZ R2,L_2X1
		
		
		MOV R2,#100
L_3X1:
		CALL TAT_HET
		CALL DELAY3X
		CALL SANG_HET
		CALL DELAY_3X
		DJNZ R2,L_3X1
		
		MOV R2,#100
L_4X1:
		CALL TAT_HET
		CALL DELAY4X
		CALL SANG_HET
		CALL DELAY_4X
		DJNZ R2,L_4X1
		
		
		MOV R2,#100
L_5X1:
		CALL TAT_HET
		CALL DELAY5X
		CALL SANG_HET
		CALL DELAY_5X
		DJNZ R2,L_5X1
		RET
	
XEN_KE_PWM:		
		MOV R2,#100
L_1X2:
		CALL TT1
		CALL DELAY1X
		CALL TT2
		CALL DELAY_1X
		DJNZ R2,L_1X2
		MOV R2,#100
L_2X2:
		CALL TT1
		CALL DELAY2X
		CALL TT2
		CALL DELAY_2X
		DJNZ R2,L_2X2
		
		
		MOV R2,#100
L_3X2:
		CALL TT1
		CALL DELAY3X
		CALL TT2
		CALL DELAY_3X
		DJNZ R2,L_3X2
		
		MOV R2,#100
L_4X2:
		CALL TT1
		CALL DELAY4X
		CALL TT2
		CALL DELAY_4X
		DJNZ R2,L_4X2
		
		
		MOV R2,#100
L_5X2:
		CALL TT1
		CALL DELAY5X
		CALL TT2
		CALL DELAY_5X
		DJNZ R2,L_5X2
		
		
		
		MOV R2,#100
L_1X3:
		CALL TT2
		CALL DELAY1X
		CALL TT1
		CALL DELAY_1X
		DJNZ R2,L_1X3
		MOV R2,#100
L_2X3:
		CALL TT2
		CALL DELAY2X
		CALL TT1
		CALL DELAY_2X
		DJNZ R2,L_2X3
		
		
		MOV R2,#100
L_3X3:
		CALL TT2
		CALL DELAY3X
		CALL TT1
		CALL DELAY_3X
		DJNZ R2,L_3X3
		
		MOV R2,#100
L_4X3:
		CALL TT2
		CALL DELAY4X
		CALL TT1
		CALL DELAY_4X
		DJNZ R2,L_4X3
		
		
		MOV R2,#100
L_5X3:
		CALL TT2
		CALL DELAY5X
		CALL TT1
		CALL DELAY_5X
		DJNZ R2,L_5X3	
		
		RET
		
		
TT1:
		CALL SANG_KT1
		CALL TAT_KT2
		CALL SANG_KT3
		CALL TAT_KT4
		CALL SANG_KT5
		CALL TAT_KT7
		CALL SANG_KT9
		SETB C24
		CLR C28	
			
		RET
TT2:
		CALL TAT_KT1
		CALL SANG_KT2
		CALL TAT_KT3
		CALL SANG_KT4
		CALL TAT_KT5
		CALL SANG_KT7
		CALL TAT_KT9
		CLR C24
		SETB C28	
		
		RET
		
		
		
		
XEN2_KE_PWM:		
		MOV R2,#100
L_1X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY1X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_1X
		DJNZ R2,L_1X4
		MOV R2,#100
L_2X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY2X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_2X
		DJNZ R2,L_2X4
		
		
		MOV R2,#100
L_3X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY3X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_3X
		DJNZ R2,L_3X4
		
		MOV R2,#100
L_4X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY4X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_4X
		DJNZ R2,L_4X4
		
		
		MOV R2,#100
L_5X4:
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY5X
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY_5X
		DJNZ R2,L_5X4
		
		
		
		MOV R2,#100
L_1X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY1X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_1X
		DJNZ R2,L_1X5
		MOV R2,#100
L_2X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY2X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_2X
		DJNZ R2,L_2X5
		
		
		MOV R2,#100
L_3X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY3X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_3X
		DJNZ R2,L_3X5
		
		MOV R2,#100
L_4X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY4X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_4X
		DJNZ R2,L_4X5
		
		
		MOV R2,#100
L_5X5:
		CALL TAT_H1
		CALL SANG_H2
		CALL DELAY5X
		CALL SANG_H1
		CALL TAT_H2
		CALL DELAY_5X
		DJNZ R2,L_5X5	
		
		RET		
		
		
		
		
		
		
		
		

CHOP_CHOP:
	MOV R0,#20
L_CHOP_CHOP:
	CALL SANG_HET
	CALL DELAY50MS
	CALL TAT_HET
	CALL DELAY50MS	
	DJNZ R0,L_CHOP_CHOP
	RET
	
XEN_KE:
	MOV R0,#20
L_XEN_KE:
	MOV P0,#10101010B
	MOV P1,#01010101B
	MOV P2,#10101010B
	MOV P3,#01010101B
	CALL DELAY50MS
	MOV P0,#01010101B
	MOV P1,#10101010B
	MOV P2,#01010101B
	MOV P3,#10101010B
	CALL DELAY50MS
	DJNZ R0,L_XEN_KE
	RET
	

	
VAO_RA:
	CALL TAT_H1
	CALL TAT_H2
	SETB C01
	SETB C20
	CALL DELAY50MS
	CLR C01
	CLR C20
	SETB C02
	SETB C19
	CALL DELAY50MS
	CLR C02
	CLR C19
	SETB C03
	SETB C18
	CALL DELAY50MS
	CLR C03
	CLR C18
	SETB C04
	SETB C17
	CALL DELAY50MS
	CLR C04
	CLR C17
	SETB C05
	SETB C16
	CALL DELAY50MS
	CLR C05
	CLR C16
	SETB C06
	SETB C15
	CALL DELAY50MS
	CLR C06
	CLR C15
	SETB C07
	SETB C14
	CALL DELAY50MS
	CLR C07
	CLR C14
	SETB C08
	SETB C13
	CALL DELAY50MS
	CLR C08
	CLR C13
	SETB C09
	SETB C12
	CALL DELAY50MS
	CLR C09
	CLR C12
	SETB C10
	SETB C11
	CALL DELAY50MS
	SETB C10
	SETB C11
	CALL DELAY50MS
	SETB C09
	SETB C12
	CALL DELAY50MS
	SETB C08
	SETB C13
	CALL DELAY50MS
	SETB C07
	SETB C14
	CALL DELAY50MS
	SETB C06
	SETB C15
	CALL DELAY50MS
	SETB C05
	SETB C16
	CALL DELAY50MS
	SETB C04
	SETB C17
	CALL DELAY50MS
	SETB C03
	SETB C18
	CALL DELAY50MS
	SETB C02
	SETB C19
	CALL DELAY50MS
	SETB C01
	SETB C20
	CALL SANG_H2
	CALL DELAY50MS
	CLR C11
	CLR C10
	CLR C21
	CLR C32
	CALL DELAY50MS
	CLR C09
	CLR C12
	CLR C22
	CLR C31
	CALL DELAY50MS
	CLR C08
	CLR C13
	CLR C23
	CLR C30
	CALL DELAY50MS
	CLR C07
	CLR C14
	CLR C24
	CLR C29
	CALL DELAY50MS
	CLR C06
	CLR C15
	CLR	C25
	CLR C28
	CALL DELAY50MS
	CLR C05
	CLR C16
	CLR C26
	CLR C27
	CALL DELAY50MS
	CLR C04
	CLR C17
	CALL DELAY50MS
	CLR C03
	CLR C18
	CALL DELAY50MS
	CLR C02
	CLR C19
	CALL DELAY50MS
	CLR C01
	CLR C20
	CALL DELAY50MS
	RET










XEN_KE2:
	MOV R0,#20
L_XEN_KE2:
	CALL SANG_H1
	CALL TAT_H2
	CALL DELAY50MS
	CALL TAT_H1
	CALL SANG_H2
	CALL DELAY50MS
	DJNZ R0,L_XEN_KE2
	RET









SANG_HET:
	MOV P3,#255
	MOV P0,#255
	MOV P1,#255
	MOV P2,#255
	RET
TAT_HET:
	MOV P1,#0
	MOV P2,#0
	MOV P3,#0
	MOV P0,#0
	RET
;---------------------	
SANG_H1:
	MOV P1,#255
	MOV P0,#255
	SETB C17
	SETB C18
	SETB C19
	SETB C20
	RET
TAT_H1:
	MOV P1,#0
	MOV P0,#0
	CLR  C17
	CLR  C18
	CLR  C19
	CLR  C20
	RET	
;---------------------
SANG_H2:
	SETB C21
	SETB C22
	SETB C23
	SETB C24
	MOV P3,#255
	RET
TAT_H2:	
	CLR C21
	CLR C22
	CLR C23
	CLR C24
	MOV P3,#0
	RET
;-------------------------
SANG_KT1:
	SETB C01
	SETB C02
	SETB C03
	SETB C04
	SETB C05
	SETB C06
	RET

SANG_KT2:
	SETB C07
	SETB C08
	SETB C09
	SETB C10
	SETB C11
	SETB C12
	RET

SANG_KT3:
	SETB C13
	SETB C14
	SETB C15
	SETB C16
	RET

SANG_KT4:
	SETB C17
	SETB C18
	SETB C19
	SETB C20
	RET

SANG_KT5:
	SETB C21
	SETB C22
	SETB C23
	RET
;SANG KT6  SETB C24

SANG_KT7:
	SETB C25
	SETB C26
	SETB C27
	RET
;SANG KT8  SETB C28

SANG_KT9:
	SETB C29
	SETB C30
	SETB C31
	SETB C32
	RET

TAT_KT1:
	CLR C01
	CLR C02
	CLR C03
	CLR C04
	CLR C05
	CLR C06
	RET

TAT_KT2:
	CLR C07
	CLR C08
	CLR C09
	CLR C10
	CLR C11
	CLR C12
	RET

TAT_KT3:
	CLR C13
	CLR C14
	CLR C15
	CLR C16
	RET

TAT_KT4:
	CLR C17
	CLR C18
	CLR C19
	CLR C20
	RET

TAT_KT5:
	CLR C21
	CLR C22
	CLR C23
	RET
;TAT KT6  CLR C24

TAT_KT7:
	CLR C25
	CLR C26
	CLR C27
	RET
;TAT KT8  CLR C28

TAT_KT9:
	CLR C29
	CLR C30
	CLR C31
	CLR C32
	RET
;-------------------------

DELAY500MS:
		CALL DELAY250MS
		CALL DELAY250MS
		RET
DELAY250MS:
		CALL DELAY50MS
		CALL DELAY200MS
		RET
DELAY200MS:
		CALL DELAY100MS
		CALL DELAY100MS
		RET
DELAY150MS:
		CALL DELAY50MS
		CALL DELAY100MS
		RET		
DELAY100MS:
		CALL DELAY50MS
		CALL DELAY50MS
		RET
DELAY50MS:
		CALL DELAY25MS
		CALL DELAY25MS
		RET
DELAY25MS:
	MOV 30H,#100
L_DELAY25MS:
	MOV 31H,#249
	DJNZ 31H,$
	DJNZ 30H,L_DELAY25MS
	RET



DELAY1X:
		NOP
		RET
DELAY2X:
		MOV R0,#50
		DJNZ R0,$
		RET
DELAY3X:
		MOV R0,#100
		DJNZ R0,$
		RET
DELAY4X:
		MOV R0,#200
		DJNZ R0,$
		RET
DELAY5X:
		CALL DELAY4X
		CALL DELAY4X
		RET
		
DELAY_1X:
		CALL DELAY5X
		RET
DELAY_2X:
		CALL DELAY2X
		CALL DELAY3X
		CALL DELAY4X
		RET
DELAY_3X:
		CALL DELAY3X
		CALL DELAY4X
		RET
DELAY_4X:
		CALL DELAY4X
		RET
DELAY_5X:
		CALL DELAY1X
		RET

END
