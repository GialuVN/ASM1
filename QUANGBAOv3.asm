;======definition========

SDH DATA 31H				;LUU CON TRO DU LIEU
SDL DATA 32H				;<>
COU	DATA 33H
IND DATA 34H
DED DATA 35H
COL	DATA 36H

SHI	BIT	 00H
REA BIT  01H
ORG 00H
MAIN:
;KHOI TAO
		
		CLR P1.0			;OE ,CHO PHEP
		CLR	 P1.1			;ST_CP ,SAN SANG
		CLR  P1.2			;SH_CP ,SAN SANG
		SETB REA
		MOV DPTR,#THI
		MOV R0,#0
		MOV R1,#0
		MOV R2,#0
		MOV R3,#0
		MOV R4,#0
		MOV R5,#0
		MOV R6,#0
		MOV R7,#0
		MOV COL,#0			;MAC DINH COT 1
		MOV COU,#0
		
		CALL READ_DATA
LOOP6:	
		MOV R0,#50H
LOOP5:
		MOV R2,#4
LOOP4:
		MOV A,@R0
		MOV R1,#8
LOOP3:
		RLC A
		MOV P1.3,C
		CALL CLOCK_W
		DJNZ R1,LOOP3
		INC R0
		DJNZ R2,LOOP4
		CALL CLOCK_D
		CALL ROWS
		CALL DELAY10M
		CLR P1.7
		INC COU
		MOV A,COU
		CJNE A,#8,LOOP5
		MOV COU,#0
		JMP LOOP6
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
READ_DATA:
		PUSH 0
		PUSH 1
		PUSH 2
		CLR P1.7
		MOV R0,#40H
LOOP2:
		MOV R1,COL
LOOP1:
		MOV A,R1
		MOVC A,@A+DPTR
		MOV @R0,A
		INC R0
		MOV A,R1
		ADD A,#8
		MOV R1,A
		INC R2
		CJNE R2,#4,LOOP1
		MOV R2,#0
		INC COL
		MOV A,COL
		CJNE A,#8,LOOP2
		MOV COL,#0
		JNB REA,END_READ
		MOV IND,#32
		CALL INC_DPTR
		MOV SDH,DPH			;CAT CON TRO DU LIEU
		MOV SDL,DPL			;<>
		CLR REA
		JMP LOOP2
END_READ:
		POP 2
		POP 1
		POP 0
		RET























;>TANG DPTR
INC_DPTR:
		PUSH 0
		MOV R0,IND
REP_INC_DPTR:
		INC DPTR
		DJNZ R0,REP_INC_DPTR
		POP 0
		RET
ROWS:	
		MOV A,COU
		CJNE A,#0,ROW2
		CLR P1.4
		CLR P1.5
		CLR P1.6
		SETB P1.7
		JMP END_ROW
ROW2:
		CJNE A,#1,ROW3
		SETB P1.4
		CLR P1.5
		CLR P1.6
		SETB P1.7
		JMP END_ROW
ROW3:
		CJNE A,#2,ROW4
		CLR P1.4
		SETB P1.5
		CLR P1.6
		SETB P1.7
		JMP END_ROW
ROW4:
		CJNE A,#3,ROW5
		SETB P1.4
		SETB P1.5
		CLR P1.6
		SETB P1.7
		JMP END_ROW
ROW5:
		CJNE A,#4,ROW6
		CLR P1.4
		CLR P1.5
		SETB P1.6
		SETB P1.7
		JMP END_ROW
ROW6:
		CJNE A,#5,ROW7
		SETB P1.4
		CLR P1.5
		SETB P1.6
		SETB P1.7
		JMP END_ROW
ROW7:
		CJNE A,#6,ROW8
		CLR P1.4
		SETB P1.5
		SETB P1.6
		SETB P1.7
		JMP END_ROW
ROW8:
		CJNE A,#7,END_ROW
		SETB P1.4
		SETB P1.5
		SETB P1.6
		SETB P1.7
END_ROW:
		RET

CLOCK_D:
		SETB P1.1
		NOP
		NOP
		NOP
		NOP
		CLR P1.1
		RET
CLOCK_W:
		SETB P1.2
		NOP
		NOP
		NOP
		NOP
		CLR P1.2
		RET
DELAY10M:
		PUSH 0
		PUSH 1
		MOV R0,#30
REP_DELAY10M:
		MOV R1,#100
		DJNZ R1,$
		DJNZ R0,REP_DELAY10M
		POP 1
		POP 0
		RET
THI:
db 0FFh, 0FFh, 0FFh, 081h, 081h, 0FFh, 0FFh, 0FFh    ;Ma Ma Tran

db 0FFh, 081h, 081h, 0E7h, 0E7h, 081h, 081h, 0FFh    ;Ma Ma Tran

db 0FFh, 0F9h, 0F9h, 081h, 081h, 0F9h, 0F9h, 0FFh    ;Ma Ma Tran

db 0FFh, 081h, 083h, 0F7h, 0F7h, 083h, 081h, 0FFh    ;Ma Ma Tran

		END
	