
;KHAI BAO
XLOW DATA 30H
XHIG DATA 31H
TEM DATA 20H
WAR BIT TEM.0

ORG 0
JMP MAIN
ORG 000BH
JMP INT_PWM
MAIN:
;KHOI TAO
MOV TMOD,#02H
MOV IE,#82H
SETB TR0
SETB TF0
;CT CHINH
MAINX:
	MOV XLOW,#1
LOOP1:
	CALL CONTRO
	CALL DELAY
	INC XLOW
	MOV A,XLOW
	CJNE A,#255,LOOP1
LOOP2:
	CALL CONTRO
	CALL DELAY
	DEC XLOW
	MOV A,XLOW
	CJNE A,#0,LOOP2
	JMP MAINX


;DIEU CHINH DO RONG XUNG 1 - 255
CONTRO:
	PUSH ACC
	MOV A,XLOW
	CPL A
	ADD A,#1
	MOV XHIG,A
	POP ACC
	RET
;PHAT XUNG PWM 3.7KHZ
INT_PWM:
	JNB WAR,SECON
	MOV P1,#00H
	MOV TL0,XLOW
	CLR WAR
	RETI
SECON:
	MOV P1,#0FFH
	MOV TL0,XHIG
	SETB WAR
	RETI
	
DELAY:
	PUSH 00H
	PUSH 01H
	MOV R0,#50
LOOP_DELAY:
	MOV R1,#100
	DJNZ R1,$
	DJNZ R0,LOOP_DELAY
	POP 01H
	POP 00H
	RET
END
	
	