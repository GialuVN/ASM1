;CHUONG TRINH DIEU KHIEN 2X16 LED SANG DON(CUNG CHIEU+NGUOC CHIEU)
;AUTHOR: MR.THI
;MAIL:LMTHI1001@GMAIL.COM
;TIME: 28/05/2011
ORG 0
R22	EQU	32H
R33	EQU	33H

R222	EQU	34H
R333	EQU	35H

R44		EQU	36H
R55		EQU	37H
R444	EQU	38H
R555	EQU	39H
;=====BIT NHO TAM===========
TEM  	DATA 20H
FLAG1   BIT  TEM.0
FLAG2   BIT  TEM.1

MAIN:

CALL SANG_DON_16K1
CALL SANG_DON_16K2
CALL SANG_DON_16_N1
CALL SANG_DON_16_N2



JMP MAIN

;=====================B-A==========================
SANG_DON_16K1:
			MOV R22,#11111111B
			MOV R33,#11111111B
			MOV R7,#16
L2:	
			MOV R222,#01111111B
			MOV R333,#11111111B
			MOV A,R7
			MOV R6,A
L1:			
			MOV A,R222
			ANL A,R22
			MOV P0,A
			MOV P1,A
			MOV A,R333
			ANL A,R33
			MOV P2,A
			MOV P3,A
			CALL DELAY
			MOV R2,R222
			MOV R3,R333
			CALL QUAY_PHAI16
			MOV R222,R2
			MOV R333,R3
			DJNZ R6,L1
			MOV R2,R22
			MOV R3,R33
			CLR C
			CALL QUAY_TRAIC16
			MOV R22,R2
			MOV R33,R3
			DEC R7
			CJNE R7,#0,L2		
			RET
;====================A-B==========================			
SANG_DON_16K2:
			MOV R22,#11111111B
			MOV R33,#11111111B
			MOV R7,#16
L7:	
			MOV R222,#01111111B
			MOV R333,#11111111B
			MOV A,R7
			MOV R6,A
L8:			
			MOV A,R222
			ANL A,R22
			MOV P0,A
			MOV P1,A
			MOV A,R333
			ANL A,R33
			MOV P2,A
			MOV P3,A
			CALL DELAY
			MOV R2,R222
			MOV R3,R333
			CALL QUAY_TRAI16
			MOV R222,R2
			MOV R333,R3
			DJNZ R6,L8
			MOV R2,R22
			MOV R3,R33
			CLR C
			CALL QUAY_PHAIC16
			MOV R22,R2
			MOV R33,R3
			DEC R7
			CJNE R7,#0,L7		
			RET			
			
;=================B-A======================			
SANG_DON_16_N1:

			MOV R22,#11111111B
			MOV R33,#11111111B
			MOV R44,#11111111B
			MOV R55,#11111111B
			
			MOV R7,#16
L3:	
			MOV R222,#01111111B
			MOV R333,#11111111B
			
			MOV R444,#11111111B
			MOV R555,#11111110B
			MOV A,R7
			MOV R6,A
L4:			
			MOV A,R222
			ANL A,R22
			MOV P0,A
			MOV A,R333
			ANL A,R33
			MOV P2,A
			
			MOV A,R444
			ANL A,R44
			MOV P1,A
			MOV A,R555
			ANL A,R55
			MOV P3,A
			
			CALL DELAY
			MOV R2,R222
			MOV R3,R333
			CALL QUAY_PHAI16
			MOV R222,R2
			MOV R333,R3

			MOV R2,R444
			MOV R3,R555
			CALL QUAY_TRAI16
			MOV R444,R2
			MOV R555,R3
			
			DJNZ R6,L4
			MOV R2,R22
			MOV R3,R33
			CLR C
			CALL QUAY_TRAIC16
			MOV R22,R2
			MOV R33,R3
			
			MOV R2,R44
			MOV R3,R55
			CLR C
			CALL QUAY_PHAIC16
			MOV R44,R2
			MOV R55,R3
	
			DEC R7
			CJNE R7,#0,L3		
			RET
;=============A-B=====================			
SANG_DON_16_N2:

			MOV R22,#11111111B
			MOV R33,#11111111B
			MOV R44,#11111111B
			MOV R55,#11111111B
			
			MOV R7,#16
L5:	
			MOV R222,#11111111B
			MOV R333,#11111110B
			
			MOV R444,#01111111B
			MOV R555,#11111111B
			MOV A,R7
			MOV R6,A
L6:			
			MOV A,R222
			ANL A,R22
			MOV P0,A
			MOV A,R333
			ANL A,R33
			MOV P2,A
			
			MOV A,R444
			ANL A,R44
			MOV P1,A
			MOV A,R555
			ANL A,R55
			MOV P3,A
			
			CALL DELAY
			MOV R2,R222
			MOV R3,R333
			CALL QUAY_TRAI16
			MOV R222,R2
			MOV R333,R3

			MOV R2,R444
			MOV R3,R555
			CALL QUAY_PHAI16
			MOV R444,R2
			MOV R555,R3
			
			DJNZ R6,L6
			MOV R2,R22
			MOV R3,R33
			CLR C
			CALL QUAY_PHAIC16
			MOV R22,R2
			MOV R33,R3
			
			MOV R2,R44
			MOV R3,R55
			CLR C
			CALL QUAY_TRAIC16
			MOV R44,R2
			MOV R55,R3
	
			DEC R7
			CJNE R7,#0,L5		
			RET			

;===========R2=BYTE CAO	|R3=BYTE THAP============		
QUAY_TRAI16:
			MOV A,R3
			RL A
			MOV C,ACC.0
			MOV FLAG2,C
			MOV R3,A
			MOV A,R2
			RL A
			MOV C,ACC.0
			MOV FLAG1,C
			MOV R2,A
			MOV A,R3
			MOV C,FLAG1
			MOV ACC.0,C
			MOV R3,A
			MOV A,R2
			MOV C,FLAG2
			MOV ACC.0,C
			MOV R2,A
			RET
			
QUAY_PHAI16:
			MOV A,R2
			RR A
			MOV C,ACC.7
			MOV FLAG1,C
			MOV R2,A
			MOV A,R3
			RR A
			MOV C,ACC.7
			MOV FLAG2,C
			MOV R3,A
			MOV A,R3
			MOV C,FLAG1
			MOV ACC.7,C
			MOV R3,A
			MOV A,R2
			MOV C,FLAG2
			MOV ACC.7,C
			MOV R2,A
			RET
QUAY_TRAIC16:
			MOV A,R2
			RLC A
			MOV C,ACC.0
			MOV FLAG1,C
			MOV R2,A
			MOV A,R3
			RL A
			MOV C,ACC.0
			MOV FLAG2,C
			MOV R3,A
			MOV A,R3
			MOV C,FLAG1
			MOV ACC.0,C
			MOV R3,A
			MOV A,R2
			MOV C,FLAG2
			MOV ACC.0,C
			MOV R2,A
			RET
QUAY_PHAIC16:
			MOV A,R3
			RRC A
			MOV C,ACC.7
			MOV FLAG2,C
			MOV R3,A
			MOV A,R2
			RR A
			MOV C,ACC.7
			MOV FLAG1,C
			MOV R2,A
			MOV A,R3
			MOV C,FLAG1
			MOV ACC.7,C
			MOV R3,A
			MOV A,R2
			MOV C,FLAG2
			MOV ACC.7,C
			MOV R2,A		
			RET
;==========================================================
DELAY:
		PUSH 00H
		PUSH 01H
		MOV R0,#100
L_DELAY:
		MOV R1,#250
		DJNZ R1,$
		DJNZ R0,L_DELAY
		POP 01H
		POP 00H
		RET
END