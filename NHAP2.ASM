ORG 00H
JMP MAIN
ORG 000BH
LJMP NGAT
MAIN:
;KIEM TRA LED KHI RESET
		MOV R1,#5
MAINP:	MOV R0,#9
		MOV P0,#0FFH
		MOV A,#0FFH	
LAP10:	
		CLR C
		RLC A
		MOV P0,A
		CALL DELAY6
		DJNZ R0,LAP10
		CALL DELAY6
		MOV R0,#9
LAP13:
		SETB C
		RLC A
		MOV P0,A
		CALL DELAY6
		DJNZ R0,LAP13
		MOV R0,#9
LAP12:
	
		CLR C
		RRC A
		MOV P0,A
		CALL DELAY6
		DJNZ R0,LAP12
		MOV R0,#9
LAP14:	
		SETB C
		RRC A
		MOV P0,A
		CALL DELAY6
		DJNZ R0,LAP14
		DEC R1
		CJNE R1,#0,MAINP
;THIET LAP THONG SO DAU
		CLR P3.7
		CLR P2.7
		CLR P2.1
		CLR P2.0
		MOV TMOD,#01H
		MOV IE,#82H
		
;NAP DU LIEU VAO RAM		
		MOV R1,#00H
		MOV R0,#20H
LAP4:
		MOV A,R1
		MOV DPTR,#DATA1
		MOVC A,@A+DPTR
		CJNE A,#00H,NAP1
		MOV R1,#10H
LAP5:
		MOV @R1,#00H
		INC R1
		CJNE R1,#16H,LAP5
;THIET LAP KHI BAT NGUON MAC DINH LA 12 GIO
		MOV R7,#12
		MOV 14H,#2
		MOV 15H,#1
		JMP DELAY1S
		
NAP1:
		MOV @R0,A
		INC R0
		INC R1
		JMP LAP4
;================================
		
;CHUONG TRINH CHINH
LAP6:
		MOV R2,#0
		LCALL COMPA
		LJMP DEM
DELAY1S:
		SETB TF0
LAP7:
		LCALL HT
		CJNE R2,#21,LAP7
		LJMP LAP6
		
;DEM GIO
DEM:	
		INC 10H
		MOV A,10H
		CJNE A,#0AH,DELAY1S
		MOV 10H,#00H
		INC 11H
		MOV A,11H
		CJNE A,#06H,DELAY1S
		MOV 11H,#00H
		INC 12H
		MOV A,12H
		CJNE A,#0AH,DELAY1S
		MOV 12H,#00H
		INC 13H
		MOV A,13H
		CJNE A,#06H,DELAY1S
		MOV 13H,#00H
		INC 14H
		MOV A,14H
		INC R7
		CJNE R7,#13,LAP
		MOV R7,#01H
		MOV 14H,#01H
		MOV 15H,#00H
		LJMP	DELAY1S
LAP:
		CJNE A,#0AH,DELAY1S
		MOV 14H,#00H
		INC 15H
		LJMP DELAY1S
;CHUONG TRINH NGAT

NGAT:
		MOV TL0,#LOW(-50000)
		MOV TH0,#HIGH(-50000)
		SETB TR0
		INC R2
		RETI

;XUAT DU LIEU RA LED
HT:
		MOV R3,#0FEH
		MOV R0,#10H
LAP2:
		MOV A,@R0
		ADD A,#20H
		MOV R1,A
		MOV P1,@R1
		MOV P0,R3
		MOV A,R3
		CJNE A,#0FBH,DOT1
		CPL P1.7
DOT1:
		CJNE A,#0EFH,DOT2
		CPL P1.7
DOT2:
		LCALL DELAY
		INC R0
		MOV A,R3
		RL A
		MOV R3,A
		JB P2.1,GIO
		JB P2.0,PHUT
		JB P2.7,DEN
		MOV P0,#0FFH
		MOV P1,#00H
		CJNE R3,#0BFH,LAP2
		RET
COMPA:
		MOV A,#00H
		CJNE A,10H,EXIT1
		CJNE A,11H,EXIT1
		CJNE A,12H,EXIT1
		CJNE A,13H,EXIT1
		CALL WORK
EXIT1:
		RET
WORK:
		MOV R6,#100
LOOP:	
		CPL P3.7
		CALL DELAY
		CALL DELAY
		DJNZ R6,LOOP
		CLR P3.7
		RET
;CHINH LAI GIO,PHUT QUA CHAN P2.1,P2.0
PHUT:	
		PUSH ACC
		INC 12H
		MOV A,12H
		CJNE A,#0AH,THOAT1
		MOV 12H,#00H
		INC 13H
		MOV A,13H
		CJNE A,#06H,THOAT1
		MOV 13H,#00H
THOAT1:
		POP ACC
		JB P2.0,$
		RET
		
GIO:	
		PUSH ACC
		INC 14H
		MOV A,14H
		INC R7
		CJNE R7,#13,LAP9
		MOV R7,#01H
		MOV 14H,#01H
		MOV 15H,#00H
		JMP	THOAT2
LAP9:
		CJNE A,#0AH,THOAT2
		MOV 14H,#00H
		INC 15H
THOAT2:
		POP ACC
		JB P2.1,$
		RET	

;DIEU KHIEN DEN VA HEN GIO
DEN:
		CPL P3.7
		JB P2.7,$
		RET

;TRE 2500 MICO GIAY
DELAY:
		MOV R4,#15
LAP3:
		MOV R5,#100
		DJNZ R5,$
		DJNZ R4,LAP3
		RET
		
DELAY6:
		PUSH 01H
		MOV TMOD,#10H
LAP21:	MOV TL1,#LOW(-10000)
		MOV TH1,#HIGH(-10000)
		SETB TR1
		JNB TF1,$
		CLR TR1
		CLR TF1
		DJNZ R1,LAP21
		POP 01H
		RET	
DATA1:
	DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH,6FH,00H
	END	
	;CHUONG TRINH DONG HO SO DA DUOC VIET BOI LU MINH THI 30/12/2008,VINH LONG	